spring.application.name=RetoFinal

# ============================================
# POSTGRESQL CONFIGURATION (via HAProxy)
# ============================================
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:key_management}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:postgres_password}
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP Connection Pool
spring.datasource.hikari.maximum-pool-size=${DB_POOL_MAX_SIZE:50}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:10}
spring.datasource.hikari.connection-timeout=${DB_CONNECTION_TIMEOUT:10000}
spring.datasource.hikari.idle-timeout=${DB_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${DB_MAX_LIFETIME:1800000}
spring.datasource.hikari.pool-name=KeyManagementHikariPool

# ============================================
# JPA / HIBERNATE CONFIGURATION
# ============================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.open-in-view=false

# ============================================
# REDIS CONFIGURATION
# ============================================
# Redis mode: cluster or standalone
redis.mode=${REDIS_MODE:cluster}

# For AWS ElastiCache Cluster Mode ENABLED (recommended for production)
# Use the Configuration Endpoint from ElastiCache console
# Example: my-cluster.xxxxx.clustercfg.use1.cache.amazonaws.com:6379
spring.data.redis.cluster.nodes=${REDIS_CLUSTER_NODES:localhost:7000,localhost:7001,localhost:7002}
spring.data.redis.cluster.max-redirects=${REDIS_MAX_REDIRECTS:3}

# For AWS ElastiCache Cluster Mode DISABLED (simpler setup)
# Use the Primary Endpoint from ElastiCache console
# Example: my-replication-group.xxxxx.ng.0001.use1.cache.amazonaws.com:6379
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.ssl.enabled=${REDIS_SSL_ENABLED:false}

# Common Redis settings
spring.data.redis.timeout=${REDIS_TIMEOUT:3000}
spring.data.redis.connect-timeout=${REDIS_CONNECT_TIMEOUT:10000}

# Lettuce pool configuration
spring.data.redis.lettuce.pool.enabled=true
spring.data.redis.lettuce.pool.max-active=${REDIS_POOL_MAX_ACTIVE:50}
spring.data.redis.lettuce.pool.max-idle=${REDIS_POOL_MAX_IDLE:10}
spring.data.redis.lettuce.pool.min-idle=${REDIS_POOL_MIN_IDLE:5}
spring.data.redis.lettuce.pool.max-wait=${REDIS_POOL_MAX_WAIT:2000ms}
spring.data.redis.lettuce.shutdown-timeout=${REDIS_SHUTDOWN_TIMEOUT:100ms}

# Redisson cluster configuration
redis.cluster.nodes=${REDIS_CLUSTER_NODES:localhost:7000,localhost:7001,localhost:7002}
redis.cluster.password=${REDIS_PASSWORD:}
redis.cluster.ssl-enabled=${REDIS_SSL_ENABLED:false}
redis.cluster.connect-timeout=${REDIS_CONNECT_TIMEOUT:10000}
redis.cluster.timeout=${REDIS_CLUSTER_TIMEOUT:3000}
redis.cluster.retry-attempts=${REDIS_RETRY_ATTEMPTS:3}
redis.cluster.retry-interval=${REDIS_RETRY_INTERVAL:1500}
redis.cluster.master-pool-size=${REDIS_MASTER_POOL_SIZE:50}
redis.cluster.slave-pool-size=${REDIS_SLAVE_POOL_SIZE:50}
redis.cluster.master-min-idle=${REDIS_MASTER_MIN_IDLE:10}
redis.cluster.slave-min-idle=${REDIS_SLAVE_MIN_IDLE:10}

# ============================================
# SERVER CONFIGURATION
# ============================================
server.port=8080
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=20
server.tomcat.accept-count=100
server.tomcat.max-connections=10000

# ============================================
# ACTUATOR CONFIGURATION
# ============================================
management.endpoints.web.exposure.include=health,metrics,info,prometheus
management.endpoint.health.show-details=always
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true

# ============================================
# LOGGING CONFIGURATION
# ============================================
logging.level.root=INFO
logging.level.com.mati.RetoFinal=INFO
logging.level.org.springframework.data.redis=WARN
logging.level.org.redisson=WARN
logging.level.org.hibernate.SQL=ERROR
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n